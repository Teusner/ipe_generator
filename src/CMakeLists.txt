# ==================================================================
#  Ipe generator - cmake configuration file
# ==================================================================

add_subdirectory(core)
add_subdirectory(ipe)



# Generating PKG file
# ===================

set(IPEGENERATOR_PKG_CONFIG_FILE ${CMAKE_CURRENT_BINARY_DIR}/ipegenerator.pc)

set(IPEGENERATOR_PKG_CONFIG_CFLAGS "-I\${includedir}/ibex -I\${includedir}/codac -I\${includedir}/ipe -I\${includedir}/ipegenerator")
set(IPEGENERATOR_PKG_CONFIG_LIBS "-L\${libdir} -lcodac -lipe -lipegenerator -lz -lspiro -lpng -ljpeg")


set(IPEGENERATOR_PKG_CONFIG_LIBS "${IPEGENERATOR_PKG_CONFIG_LIBS} -lipegenerator") # Seems to be needed

file(GENERATE OUTPUT ${IPEGENERATOR_PKG_CONFIG_FILE}
        CONTENT "prefix=${CMAKE_INSTALL_PREFIX}
includedir=\${prefix}/${CMAKE_INSTALL_INCLUDEDIR}
libdir=\${prefix}/${CMAKE_INSTALL_LIBDIR}

Name: ipegenerator
Description: ${PROJECT_DESCRIPTION}
Url: ${PROJECT_HOMEPAGE_URL}
Version: ${PROJECT_VERSION}
Requires: ibex codac
Cflags: ${IPEGENERATOR_PKG_CONFIG_CFLAGS}
Libs: ${IPEGENERATOR_PKG_CONFIG_LIBS}")

install(FILES ${IPEGENERATOR_PKG_CONFIG_FILE} DESTINATION ${CMAKE_INSTALL_PKGCONFIG})


# Generating ipegenerator-config.cmake file
# ==================================

set(IPEGENERATOR_CMAKE_CONFIG_FILE ${CMAKE_CURRENT_BINARY_DIR}/ipegenerator-config.cmake)
file(WRITE ${IPEGENERATOR_CMAKE_CONFIG_FILE}
        "# Try to find ipegenerator
# This file has been generated by CMake

find_path(IPE_INCLUDE_DIR ipe.h
          PATH_SUFFIXES include/ipe)

find_path(IPEGENERATOR_INCLUDE_DIR ipegenerator.h
          PATH_SUFFIXES include/ipegenerator)

find_library(IPEGENERATOR_LIBRARY NAMES ipegenerator
             PATH_SUFFIXES lib)

find_library(IPE_LIBRARY NAMES ipe
             PATH_SUFFIXES lib)



set(IPEGENERATOR_VERSION ${PROJECT_VERSION})
set(IPEGENERATOR_LIBRARIES \${IPEGENERATOR_LIBRARY} \${IPE_LIBRARY} -lz -lspiro -ljpeg -lpng  )
set(IPEGENERATOR_INCLUDE_DIRS \${IPEGENERATOR_INCLUDE_DIR} \${IPE_INCLUDE_DIR} )
set(IPEGENERATOR_FOUND TRUE)

set(IPEGENERATOR_C_FLAGS \"${CMAKE_C_FLAGS}\")
set(IPEGENERATOR_CXX_FLAGS \"${CMAKE_CXX_FLAGS}\")
")

if((CMAKE_BUILD_TYPE MATCHES Debug) AND (CMAKE_CXX_COMPILER_ID STREQUAL "GNU"))
    # If ipegenerator is built in Debug, -pg (added by Ibex at the time of ipegenerator
    # compilation) might be also necessary to be able to successfully build 
    # programs in Release (otherwise it would be only added by Ibex if the program 
    # is built in Debug)...
    file(APPEND ${IPEGENERATOR_CMAKE_CONFIG_FILE} "
set(CMAKE_EXE_LINKER_FLAGS \"${CMAKE_EXE_LINKER_FLAGS} -pg\")
")
endif()


install(FILES ${IPEGENERATOR_CMAKE_CONFIG_FILE} DESTINATION ${CMAKE_INSTALL_CMAKE})
